<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penny's D&D Character Creator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=MedievalSharp&display=swap');

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Nunito', sans-serif;
            background: #1a1025;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(100, 50, 150, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(180, 140, 50, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(60, 30, 100, 0.2) 0%, transparent 70%);
            min-height: 100vh;
            color: #e8dcc8;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            text-align: center;
            padding: 1.5rem 0 1rem;
        }

        .header .icon { font-size: 2rem; display: block; margin-bottom: 0.3rem; }

        .header h1 {
            font-family: 'MedievalSharp', cursive;
            font-size: 1.7rem;
            color: #d4a843;
            text-shadow: 0 0 20px rgba(212, 168, 67, 0.3);
        }

        .header .subtitle {
            font-size: 0.85rem;
            color: #9a8a70;
            margin-top: 0.3rem;
        }

        .progress-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            height: 10px;
            margin-bottom: 0.5rem;
            overflow: hidden;
            border: 1px solid rgba(212,168,67,0.2);
        }

        .progress-fill {
            background: linear-gradient(90deg, #8b5cf6, #d4a843);
            height: 100%;
            border-radius: 20px;
            transition: width 0.4s ease;
        }

        .progress-label {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: #9a8a70;
            margin-bottom: 0.8rem;
        }

        .card {
            background: rgba(30, 20, 45, 0.85);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(212,168,67,0.2);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .step-title {
            font-family: 'MedievalSharp', cursive;
            font-size: 1.3rem;
            color: #d4a843;
            text-align: center;
            margin-bottom: 0.3rem;
        }

        .step-subtitle {
            font-size: 0.85rem;
            color: #9a8a70;
            text-align: center;
            margin-bottom: 1.2rem;
        }

        /* Name input */
        .name-input {
            width: 100%;
            background: rgba(255,255,255,0.08);
            border: 2px solid rgba(212,168,67,0.3);
            border-radius: 12px;
            padding: 0.8rem 1rem;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #e8dcc8;
            text-align: center;
            outline: none;
            transition: border-color 0.2s;
        }
        .name-input:focus { border-color: #d4a843; }
        .name-input::placeholder { color: #6a5a48; }

        /* Grid selections */
        .option-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .option-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(212,168,67,0.15);
            border-radius: 12px;
            padding: 0.7rem;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }

        .option-card:hover {
            background: rgba(212,168,67,0.1);
            border-color: rgba(212,168,67,0.4);
            transform: translateY(-2px);
        }

        .option-card.selected {
            background: rgba(212,168,67,0.15);
            border-color: #d4a843;
            box-shadow: 0 0 12px rgba(212,168,67,0.2);
        }

        .option-card .opt-icon { font-size: 1.5rem; display: block; margin-bottom: 0.2rem; }
        .option-card .opt-name { font-weight: 700; font-size: 0.9rem; color: #e8dcc8; }
        .option-card .opt-desc { font-size: 0.7rem; color: #9a8a70; margin-top: 0.15rem; }

        /* Alignment grid */
        .align-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.4rem;
        }

        .align-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(212,168,67,0.15);
            border-radius: 10px;
            padding: 0.6rem 0.3rem;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: #c0b090;
        }

        .align-card:hover {
            background: rgba(212,168,67,0.1);
            border-color: rgba(212,168,67,0.4);
        }

        .align-card.selected {
            background: rgba(212,168,67,0.15);
            border-color: #d4a843;
            color: #d4a843;
        }

        /* Stats */
        .stat-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(212,168,67,0.15);
            border-radius: 10px;
            padding: 0.6rem 0.8rem;
            margin-bottom: 0.4rem;
        }

        .stat-name {
            font-weight: 700;
            font-size: 0.9rem;
            color: #d4a843;
            min-width: 50px;
        }

        .stat-abbr {
            font-size: 0.7rem;
            color: #9a8a70;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: #e8dcc8;
            min-width: 35px;
            text-align: center;
        }

        .stat-mod {
            font-size: 0.8rem;
            color: #9a8a70;
            min-width: 35px;
            text-align: center;
        }

        .roll-btn {
            background: rgba(139, 92, 246, 0.3);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 8px;
            padding: 0.3rem 0.6rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 0.75rem;
            color: #c4b5f0;
            cursor: pointer;
            transition: all 0.15s;
        }

        .roll-btn:hover { background: rgba(139, 92, 246, 0.5); }

        .roll-all-btn {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
            border: none;
            border-radius: 12px;
            padding: 0.8rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            color: white;
            cursor: pointer;
            margin-top: 0.8rem;
            transition: all 0.2s;
        }

        .roll-all-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4); }

        .dice-display {
            font-size: 0.7rem;
            color: #7a6a58;
            text-align: center;
        }

        @keyframes diceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(15deg) scale(1.1); }
            50% { transform: rotate(-10deg) scale(1.05); }
            75% { transform: rotate(5deg) scale(1.1); }
            100% { transform: rotate(0deg) scale(1); }
        }

        .rolling { animation: diceRoll 0.4s ease; }

        /* Buttons */
        .btn {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #d4a843, #b8922e);
            border: none;
            border-radius: 12px;
            padding: 0.8rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 1.05rem;
            color: #1a1025;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.2s;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(212,168,67,0.3); }

        .btn:disabled {
            opacity: 0.4;
            cursor: default;
            transform: none;
            box-shadow: none;
        }

        /* Character sheet */
        .sheet {
            text-align: center;
        }

        .sheet-name {
            font-family: 'MedievalSharp', cursive;
            font-size: 2rem;
            color: #d4a843;
            margin-bottom: 0.3rem;
            text-shadow: 0 0 20px rgba(212,168,67,0.3);
        }

        .sheet-subtitle {
            font-size: 1rem;
            color: #c0b090;
            margin-bottom: 1rem;
        }

        .sheet-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(212,168,67,0.15);
            border-radius: 12px;
            padding: 0.8rem;
            margin-bottom: 0.6rem;
            text-align: left;
        }

        .sheet-section-title {
            font-family: 'MedievalSharp', cursive;
            font-size: 0.9rem;
            color: #d4a843;
            margin-bottom: 0.4rem;
        }

        .sheet-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.4rem;
        }

        .sheet-stat {
            text-align: center;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 0.5rem;
        }

        .sheet-stat .label { font-size: 0.65rem; color: #9a8a70; font-weight: 700; }
        .sheet-stat .value { font-size: 1.3rem; font-weight: 800; color: #d4a843; }
        .sheet-stat .mod { font-size: 0.75rem; color: #9a8a70; }

        .sheet-row {
            display: flex;
            justify-content: space-between;
            padding: 0.2rem 0;
            font-size: 0.9rem;
        }

        .sheet-row .label { color: #9a8a70; }
        .sheet-row .value { color: #e8dcc8; font-weight: 700; }

        .btn-row {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-row .btn { flex: 1; }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e8dcc8;
        }

        .btn-secondary:hover { background: rgba(255,255,255,0.2); box-shadow: none; }

        /* Enhanced Character Sheet */
        .sheet-header-bar {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.3rem;
            margin-bottom: 0.8rem;
        }

        .sheet-header-item {
            background: rgba(255,255,255,0.05);
            border-bottom: 2px solid rgba(212,168,67,0.3);
            padding: 0.3rem 0.5rem;
        }

        .sheet-header-item .label {
            font-size: 0.6rem;
            color: #9a8a70;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sheet-header-item .value {
            font-size: 0.85rem;
            font-weight: 700;
            color: #e8dcc8;
        }

        .combat-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.6rem;
        }

        .combat-box {
            flex: 1;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(212,168,67,0.3);
            border-radius: 12px;
            padding: 0.5rem;
            text-align: center;
        }

        .combat-box .label {
            font-size: 0.6rem;
            color: #9a8a70;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .combat-box .value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #d4a843;
            line-height: 1.2;
        }

        .combat-box .sub {
            font-size: 0.6rem;
            color: #7a6a58;
        }

        .hp-box {
            background: rgba(180, 50, 50, 0.15);
            border-color: rgba(180, 80, 80, 0.4);
        }

        .hp-box .value { color: #e85555; }

        .saves-skills-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.1rem 0.8rem;
        }

        .save-skill-row {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.12rem 0;
            font-size: 0.8rem;
        }

        .prof-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 1.5px solid rgba(212,168,67,0.5);
            flex-shrink: 0;
        }

        .prof-dot.filled {
            background: #d4a843;
            border-color: #d4a843;
        }

        .save-skill-row .sk-mod {
            font-weight: 700;
            color: #d4a843;
            min-width: 24px;
        }

        .save-skill-row .sk-name { color: #c0b090; }

        .save-skill-row .sk-ability {
            font-size: 0.6rem;
            color: #7a6a58;
        }

        .trait-item {
            padding: 0.25rem 0;
            font-size: 0.8rem;
            color: #c0b090;
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }

        .trait-item:last-child { border-bottom: none; }

        .trait-item .trait-name {
            font-weight: 700;
            color: #e8dcc8;
        }

        .equip-item {
            padding: 0.15rem 0;
            font-size: 0.8rem;
            color: #c0b090;
        }

        .prof-category {
            font-size: 0.8rem;
            padding: 0.2rem 0;
        }

        .prof-category .pc-label {
            color: #9a8a70;
            font-weight: 700;
            font-size: 0.7rem;
            text-transform: uppercase;
        }

        .prof-category .pc-value { color: #c0b090; }

        .sheet-stats-grid-6 {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.3rem;
        }

        .stat-box {
            text-align: center;
            background: rgba(255,255,255,0.05);
            border: 1.5px solid rgba(212,168,67,0.2);
            border-radius: 10px;
            padding: 0.4rem 0.2rem;
        }

        .stat-box .sb-label {
            font-size: 0.6rem;
            color: #9a8a70;
            font-weight: 700;
        }

        .stat-box .sb-mod {
            font-size: 1.2rem;
            font-weight: 800;
            color: #d4a843;
        }

        .stat-box .sb-score {
            font-size: 0.7rem;
            color: #7a6a58;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
            padding: 0.1rem 0.3rem;
            display: inline-block;
            margin-top: 0.15rem;
        }

        .stat-box .sb-bonus {
            font-size: 0.55rem;
            color: #8b5cf6;
        }

        .btn-row-3 {
            display: flex;
            gap: 0.4rem;
            margin-top: 1rem;
        }

        .btn-row-3 .btn { flex: 1; font-size: 0.9rem; padding: 0.7rem; }

        .prof-bonus-bar {
            text-align: center;
            background: rgba(139, 92, 246, 0.15);
            border: 1.5px solid rgba(139, 92, 246, 0.3);
            border-radius: 10px;
            padding: 0.4rem;
            margin-bottom: 0.6rem;
            font-size: 0.85rem;
            color: #c4b5f0;
        }

        .prof-bonus-bar strong {
            font-size: 1.1rem;
            color: #d4a843;
        }

        @media print {
            body { background: white !important; color: #333 !important; }
            .container { max-width: 100%; }
            .header, .progress-bar, .progress-label, .btn-row-3 { display: none !important; }
            .card { border: 1px solid #ccc; box-shadow: none; background: white !important; }
            .sheet-name { color: #333 !important; text-shadow: none !important; }
            .sheet-subtitle { color: #555 !important; }
            .combat-box { border-color: #999; background: #f9f9f9 !important; }
            .combat-box .value { color: #333 !important; }
            .combat-box .label, .combat-box .sub { color: #666 !important; }
            .hp-box { background: #fff0f0 !important; }
            .hp-box .value { color: #c33 !important; }
            .sheet-section { border-color: #ccc; background: #fafafa !important; }
            .sheet-section-title { color: #333 !important; }
            .prof-dot { border-color: #999; }
            .prof-dot.filled { background: #333; border-color: #333; }
            .stat-box { border-color: #999; background: #f5f5f5 !important; }
            .stat-box .sb-mod { color: #333 !important; }
            .stat-box .sb-label { color: #666 !important; }
            .save-skill-row .sk-mod { color: #333 !important; }
            .save-skill-row .sk-name { color: #444 !important; }
            .sheet-header-item { border-color: #999; background: #f9f9f9 !important; }
            .sheet-header-item .value { color: #333 !important; }
            .sheet-header-item .label { color: #666 !important; }
            .prof-bonus-bar { background: #f0f0f5 !important; border-color: #999; color: #333 !important; }
            .prof-bonus-bar strong { color: #333 !important; }
            .trait-item { color: #444 !important; }
            .trait-item .trait-name { color: #222 !important; }
            .equip-item { color: #444 !important; }
            .prof-category .pc-label { color: #666 !important; }
            .prof-category .pc-value { color: #444 !important; }
        }

        @media (max-width: 400px) {
            .header h1 { font-size: 1.4rem; }
            .option-grid { grid-template-columns: 1fr 1fr; }
            .sheet-stats-grid { grid-template-columns: 1fr 1fr; }
            .sheet-stats-grid-6 { grid-template-columns: repeat(3, 1fr); }
            .combat-row { flex-wrap: wrap; }
            .combat-box { min-width: 45%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <span class="icon">üêâ</span>
            <h1>Penny's D&D Character Creator</h1>
            <div class="subtitle">Forge your hero</div>
        </div>

        <div class="progress-label">Step <span id="step-num">1</span> of 6</div>
        <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>

        <div class="card" id="card"></div>
    </div>

    <script>
const races = [
    { name: "Human", icon: "üßë", desc: "Versatile and ambitious" },
    { name: "Elf", icon: "üßù", desc: "Graceful and wise" },
    { name: "Dwarf", icon: "‚õèÔ∏è", desc: "Tough and sturdy" },
    { name: "Halfling", icon: "üçÄ", desc: "Lucky and nimble" },
    { name: "Gnome", icon: "üîß", desc: "Clever and curious" },
    { name: "Half-Orc", icon: "üí™", desc: "Strong and fierce" },
    { name: "Tiefling", icon: "üòà", desc: "Mysterious and charming" },
    { name: "Dragonborn", icon: "üê≤", desc: "Proud and powerful" }
];

const classes = [
    { name: "Fighter", icon: "‚öîÔ∏è", desc: "Master of weapons and armor" },
    { name: "Wizard", icon: "üîÆ", desc: "Powerful arcane spellcaster" },
    { name: "Rogue", icon: "üó°Ô∏è", desc: "Stealthy and cunning" },
    { name: "Cleric", icon: "‚úùÔ∏è", desc: "Divine healer and protector" },
    { name: "Ranger", icon: "üèπ", desc: "Wilderness tracker and hunter" },
    { name: "Bard", icon: "üéµ", desc: "Musical magic and charm" },
    { name: "Paladin", icon: "üõ°Ô∏è", desc: "Holy warrior of justice" },
    { name: "Barbarian", icon: "ü™ì", desc: "Raging unstoppable force" },
    { name: "Sorcerer", icon: "‚ö°", desc: "Born with innate magic" },
    { name: "Druid", icon: "üåø", desc: "Nature's shapeshifting guardian" },
    { name: "Monk", icon: "üëä", desc: "Martial arts master" },
    { name: "Warlock", icon: "üëÅÔ∏è", desc: "Pact-bound dark magic" }
];

const backgrounds = [
    { name: "Acolyte", icon: "üïØÔ∏è", desc: "Raised in a temple" },
    { name: "Criminal", icon: "ü¶π", desc: "Life outside the law" },
    { name: "Folk Hero", icon: "üåæ", desc: "Champion of the common people" },
    { name: "Noble", icon: "üëë", desc: "Born into privilege" },
    { name: "Sage", icon: "üìö", desc: "Scholar and researcher" },
    { name: "Soldier", icon: "‚öîÔ∏è", desc: "Trained for battle" },
    { name: "Entertainer", icon: "üé≠", desc: "Born performer" },
    { name: "Outlander", icon: "üèîÔ∏è", desc: "Raised in the wilds" }
];

const alignments = [
    "Lawful Good", "Neutral Good", "Chaotic Good",
    "Lawful Neutral", "True Neutral", "Chaotic Neutral",
    "Lawful Evil", "Neutral Evil", "Chaotic Evil"
];

const statNames = [
    { name: "Strength", abbr: "STR" },
    { name: "Dexterity", abbr: "DEX" },
    { name: "Constitution", abbr: "CON" },
    { name: "Intelligence", abbr: "INT" },
    { name: "Wisdom", abbr: "WIS" },
    { name: "Charisma", abbr: "CHA" }
];

// D&D 5e Reference Data
const raceDetails = {
    "Human":      { bonuses: [1,1,1,1,1,1], speed: 30, size: "Medium", languages: ["Common", "One extra language"], traits: ["+1 to all ability scores", "Extra Language"] },
    "Elf":        { bonuses: [0,2,0,0,0,0], speed: 30, size: "Medium", languages: ["Common", "Elvish"], traits: ["Darkvision (60 ft)", "Keen Senses (Perception prof.)", "Fey Ancestry (adv. vs charm)", "Trance (4 hr rest)"] },
    "Dwarf":      { bonuses: [0,0,2,0,0,0], speed: 25, size: "Medium", languages: ["Common", "Dwarvish"], traits: ["Darkvision (60 ft)", "Dwarven Resilience (poison resist.)", "Stonecunning"] },
    "Halfling":   { bonuses: [0,2,0,0,0,0], speed: 25, size: "Small", languages: ["Common", "Halfling"], traits: ["Lucky (reroll natural 1s)", "Brave (adv. vs frightened)", "Halfling Nimbleness"] },
    "Gnome":      { bonuses: [0,0,0,2,0,0], speed: 25, size: "Small", languages: ["Common", "Gnomish"], traits: ["Darkvision (60 ft)", "Gnome Cunning (adv. on INT/WIS/CHA saves vs magic)"] },
    "Half-Orc":   { bonuses: [2,0,1,0,0,0], speed: 30, size: "Medium", languages: ["Common", "Orc"], traits: ["Darkvision (60 ft)", "Menacing (Intimidation prof.)", "Relentless Endurance (drop to 1 HP instead of 0)", "Savage Attacks (extra crit die)"] },
    "Tiefling":   { bonuses: [0,0,0,1,0,2], speed: 30, size: "Medium", languages: ["Common", "Infernal"], traits: ["Darkvision (60 ft)", "Hellish Resistance (fire resist.)", "Infernal Legacy (Thaumaturgy cantrip)"] },
    "Dragonborn": { bonuses: [2,0,0,0,0,1], speed: 30, size: "Medium", languages: ["Common", "Draconic"], traits: ["Breath Weapon (2d6 damage)", "Damage Resistance (based on ancestry)"] }
};

const classDetails = {
    "Fighter":   { hitDie: 10, saves: [0, 2], numSkills: 2, skillChoices: ["Acrobatics","Animal Handling","Athletics","History","Insight","Intimidation","Perception","Survival"], armor: "All armor, shields", weapons: "Simple & martial weapons", features: ["Fighting Style", "Second Wind (bonus action: heal 1d10+1)"], equipment: ["Chain mail", "Martial weapon & shield or two martial weapons", "Light crossbow & 20 bolts or two handaxes", "Dungeoneer's pack or explorer's pack"] },
    "Wizard":    { hitDie: 6, saves: [3, 4], numSkills: 2, skillChoices: ["Arcana","History","Insight","Investigation","Medicine","Religion"], armor: "None", weapons: "Daggers, darts, slings, quarterstaffs, light crossbows", features: ["Spellcasting (INT)", "Arcane Recovery (regain spell slots on short rest)"], equipment: ["Quarterstaff or dagger", "Component pouch or arcane focus", "Scholar's pack or explorer's pack", "Spellbook"] },
    "Rogue":     { hitDie: 8, saves: [1, 3], numSkills: 4, skillChoices: ["Acrobatics","Athletics","Deception","Insight","Intimidation","Investigation","Perception","Performance","Persuasion","Sleight of Hand","Stealth"], armor: "Light armor", weapons: "Simple weapons, hand crossbows, longswords, rapiers, shortswords", features: ["Expertise (double prof. in 2 skills)", "Sneak Attack (1d6)", "Thieves' Cant"], equipment: ["Rapier or shortsword", "Shortbow & 20 arrows or shortsword", "Burglar's, dungeoneer's, or explorer's pack", "Leather armor, two daggers, thieves' tools"] },
    "Cleric":    { hitDie: 8, saves: [4, 5], numSkills: 2, skillChoices: ["History","Insight","Medicine","Persuasion","Religion"], armor: "Light & medium armor, shields", weapons: "Simple weapons", features: ["Spellcasting (WIS)", "Divine Domain"], equipment: ["Mace or warhammer", "Scale mail, leather, or chain mail", "Light crossbow & 20 bolts or any simple weapon", "Priest's pack or explorer's pack", "Shield & holy symbol"] },
    "Ranger":    { hitDie: 10, saves: [0, 1], numSkills: 3, skillChoices: ["Animal Handling","Athletics","Insight","Investigation","Nature","Perception","Stealth","Survival"], armor: "Light & medium armor, shields", weapons: "Simple & martial weapons", features: ["Favored Enemy", "Natural Explorer"], equipment: ["Scale mail or leather armor", "Two shortswords or two simple melee weapons", "Dungeoneer's pack or explorer's pack", "Longbow & 20 arrows"] },
    "Bard":      { hitDie: 8, saves: [1, 5], numSkills: 3, skillChoices: ["Acrobatics","Animal Handling","Arcana","Athletics","Deception","History","Insight","Intimidation","Investigation","Medicine","Nature","Perception","Performance","Persuasion","Religion","Sleight of Hand","Stealth","Survival"], armor: "Light armor", weapons: "Simple weapons, hand crossbows, longswords, rapiers, shortswords", features: ["Spellcasting (CHA)", "Bardic Inspiration (d6)"], equipment: ["Rapier, longsword, or any simple weapon", "Diplomat's pack or entertainer's pack", "Lute or any musical instrument", "Leather armor & dagger"] },
    "Paladin":   { hitDie: 10, saves: [4, 5], numSkills: 2, skillChoices: ["Athletics","Insight","Intimidation","Medicine","Persuasion","Religion"], armor: "All armor, shields", weapons: "Simple & martial weapons", features: ["Divine Sense", "Lay on Hands (5 HP healing pool)"], equipment: ["Martial weapon & shield or two martial weapons", "Five javelins or any simple melee weapon", "Priest's pack or explorer's pack", "Chain mail & holy symbol"] },
    "Barbarian": { hitDie: 12, saves: [0, 2], numSkills: 2, skillChoices: ["Animal Handling","Athletics","Intimidation","Nature","Perception","Survival"], armor: "Light & medium armor, shields", weapons: "Simple & martial weapons", features: ["Rage (2/day, +2 damage, resistance)", "Unarmored Defense (AC = 10 + DEX + CON)"], equipment: ["Greataxe or any martial melee weapon", "Two handaxes or any simple weapon", "Explorer's pack & four javelins"] },
    "Sorcerer":  { hitDie: 6, saves: [2, 5], numSkills: 2, skillChoices: ["Arcana","Deception","Insight","Intimidation","Persuasion","Religion"], armor: "None", weapons: "Daggers, darts, slings, quarterstaffs, light crossbows", features: ["Spellcasting (CHA)", "Sorcerous Origin"], equipment: ["Light crossbow & 20 bolts or any simple weapon", "Component pouch or arcane focus", "Dungeoneer's pack or explorer's pack", "Two daggers"] },
    "Druid":     { hitDie: 8, saves: [3, 4], numSkills: 2, skillChoices: ["Arcana","Animal Handling","Insight","Medicine","Nature","Perception","Religion","Survival"], armor: "Light & medium armor (nonmetal), shields (nonmetal)", weapons: "Clubs, daggers, darts, javelins, maces, quarterstaffs, scimitars, sickles, slings, spears", features: ["Spellcasting (WIS)", "Druidic (secret language)"], equipment: ["Wooden shield or any simple weapon", "Scimitar or any simple melee weapon", "Leather armor, explorer's pack, druidic focus"] },
    "Monk":      { hitDie: 8, saves: [0, 1], numSkills: 2, skillChoices: ["Acrobatics","Athletics","History","Insight","Religion","Stealth"], armor: "None", weapons: "Simple weapons, shortswords", features: ["Unarmored Defense (AC = 10 + DEX + WIS)", "Martial Arts (unarmed 1d4, bonus attack)"], equipment: ["Shortsword or any simple weapon", "Dungeoneer's pack or explorer's pack", "10 darts"] },
    "Warlock":   { hitDie: 8, saves: [4, 5], numSkills: 2, skillChoices: ["Arcana","Deception","History","Intimidation","Investigation","Nature","Religion"], armor: "Light armor", weapons: "Simple weapons", features: ["Pact Magic (CHA, slots recover on short rest)", "Otherworldly Patron"], equipment: ["Light crossbow & 20 bolts or any simple weapon", "Component pouch or arcane focus", "Scholar's pack or dungeoneer's pack", "Leather armor, any simple weapon, two daggers"] }
};

const bgDetails = {
    "Acolyte":     { skills: ["Insight", "Religion"], languages: 2, tools: [], equipment: ["Holy symbol", "Prayer book or wheel", "5 sticks of incense", "Vestments", "15 gp"], feature: "Shelter of the Faithful" },
    "Criminal":    { skills: ["Deception", "Stealth"], languages: 0, tools: ["Gaming set", "Thieves' tools"], equipment: ["Crowbar", "Dark common clothes with hood", "15 gp"], feature: "Criminal Contact" },
    "Folk Hero":   { skills: ["Animal Handling", "Survival"], languages: 0, tools: ["Artisan's tools", "Vehicles (land)"], equipment: ["Artisan's tools", "Shovel", "Iron pot", "Common clothes", "10 gp"], feature: "Rustic Hospitality" },
    "Noble":       { skills: ["History", "Persuasion"], languages: 1, tools: ["Gaming set"], equipment: ["Fine clothes", "Signet ring", "Scroll of pedigree", "25 gp"], feature: "Position of Privilege" },
    "Sage":        { skills: ["Arcana", "History"], languages: 2, tools: [], equipment: ["Bottle of ink", "Quill", "Small knife", "Letter from dead colleague", "Common clothes", "10 gp"], feature: "Researcher" },
    "Soldier":     { skills: ["Athletics", "Intimidation"], languages: 0, tools: ["Gaming set", "Vehicles (land)"], equipment: ["Insignia of rank", "Trophy from fallen enemy", "Bone dice or deck of cards", "Common clothes", "10 gp"], feature: "Military Rank" },
    "Entertainer": { skills: ["Acrobatics", "Performance"], languages: 0, tools: ["Disguise kit", "Musical instrument"], equipment: ["Musical instrument", "Favor of an admirer", "Costume", "15 gp"], feature: "By Popular Demand" },
    "Outlander":   { skills: ["Athletics", "Survival"], languages: 1, tools: ["Musical instrument"], equipment: ["Staff", "Hunting trap", "Trophy from animal", "Traveler's clothes", "10 gp"], feature: "Wanderer" }
};

const allSkills = [
    { name: "Acrobatics", ability: 1 },
    { name: "Animal Handling", ability: 4 },
    { name: "Arcana", ability: 3 },
    { name: "Athletics", ability: 0 },
    { name: "Deception", ability: 5 },
    { name: "History", ability: 3 },
    { name: "Insight", ability: 4 },
    { name: "Intimidation", ability: 5 },
    { name: "Investigation", ability: 3 },
    { name: "Medicine", ability: 4 },
    { name: "Nature", ability: 3 },
    { name: "Perception", ability: 4 },
    { name: "Performance", ability: 5 },
    { name: "Persuasion", ability: 5 },
    { name: "Religion", ability: 3 },
    { name: "Sleight of Hand", ability: 1 },
    { name: "Stealth", ability: 1 },
    { name: "Survival", ability: 4 }
];

let character = {
    name: "",
    race: null,
    class: null,
    stats: [0, 0, 0, 0, 0, 0],
    rolls: [[], [], [], [], [], []],
    locked: [false, false, false, false, false, false],
    background: null,
    alignment: null
};

let currentStep = 0;
const totalSteps = 6;

function updateProgress() {
    document.getElementById('step-num').textContent = currentStep + 1;
    document.getElementById('progress-fill').style.width = ((currentStep) / totalSteps * 100) + '%';
}

function roll4d6() {
    const dice = [1,2,3,4].map(() => Math.floor(Math.random() * 6) + 1);
    dice.sort((a, b) => a - b);
    const dropped = dice[0];
    const kept = dice.slice(1);
    return { total: kept.reduce((a, b) => a + b, 0), dice, dropped };
}

function getMod(stat) {
    const mod = Math.floor((stat - 10) / 2);
    return mod >= 0 ? `+${mod}` : `${mod}`;
}

function showStep() {
    updateProgress();
    const card = document.getElementById('card');

    switch (currentStep) {
        case 0: showNameStep(card); break;
        case 1: showRaceStep(card); break;
        case 2: showClassStep(card); break;
        case 3: showStatsStep(card); break;
        case 4: showBackgroundStep(card); break;
        case 5: showAlignmentStep(card); break;
        case 6: showSheet(card); break;
    }
}

function showNameStep(card) {
    card.innerHTML = `
        <div class="step-title">Name Your Hero</div>
        <div class="step-subtitle">What shall they be called?</div>
        <input class="name-input" id="char-name" type="text" placeholder="Enter a name..." value="${character.name}" maxlength="30" autofocus>
        <button class="btn" id="next-btn" onclick="saveName()" ${character.name ? '' : 'disabled'}>Next</button>
    `;
    const input = document.getElementById('char-name');
    input.addEventListener('input', () => {
        document.getElementById('next-btn').disabled = !input.value.trim();
    });
    input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && input.value.trim()) saveName();
    });
}

function saveName() {
    character.name = document.getElementById('char-name').value.trim();
    if (!character.name) return;
    currentStep++;
    showStep();
}

function showRaceStep(card) {
    card.innerHTML = `
        <div class="step-title">Choose Your Race</div>
        <div class="step-subtitle">What blood runs through your veins?</div>
        <div class="option-grid">
            ${races.map(r => `
                <div class="option-card ${character.race === r.name ? 'selected' : ''}" onclick="selectRace('${r.name}')">
                    <span class="opt-icon">${r.icon}</span>
                    <div class="opt-name">${r.name}</div>
                    <div class="opt-desc">${r.desc}</div>
                </div>
            `).join('')}
        </div>
        <button class="btn" id="next-btn" onclick="nextStep()" ${character.race ? '' : 'disabled'}>Next</button>
    `;
}

function selectRace(name) {
    character.race = name;
    document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
    event.target.closest('.option-card').classList.add('selected');
    document.getElementById('next-btn').disabled = false;
}

function showClassStep(card) {
    card.innerHTML = `
        <div class="step-title">Choose Your Class</div>
        <div class="step-subtitle">How will you fight?</div>
        <div class="option-grid">
            ${classes.map(c => `
                <div class="option-card ${character.class === c.name ? 'selected' : ''}" onclick="selectClass('${c.name}')">
                    <span class="opt-icon">${c.icon}</span>
                    <div class="opt-name">${c.name}</div>
                    <div class="opt-desc">${c.desc}</div>
                </div>
            `).join('')}
        </div>
        <button class="btn" id="next-btn" onclick="nextStep()" ${character.class ? '' : 'disabled'}>Next</button>
    `;
}

function selectClass(name) {
    character.class = name;
    document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
    event.target.closest('.option-card').classList.add('selected');
    document.getElementById('next-btn').disabled = false;
}

function showStatsStep(card) {
    const hasStats = character.stats.some(s => s > 0);
    card.innerHTML = `
        <div class="step-title">Roll Your Stats</div>
        <div class="step-subtitle">Roll 4d6, drop the lowest -- one roll per stat!</div>
        <div id="stats-container">
            ${statNames.map((s, i) => `
                <div class="stat-row" id="stat-row-${i}">
                    <div>
                        <span class="stat-name">${s.abbr}</span>
                        <span class="stat-abbr"> ${s.name}</span>
                    </div>
                    <div class="dice-display" id="dice-${i}">${character.rolls[i].length ? renderDice(character.rolls[i], character.stats[i]) : ''}</div>
                    <span class="stat-value" id="stat-val-${i}">${character.stats[i] || '‚Äî'}</span>
                    <span class="stat-mod" id="stat-mod-${i}">${character.stats[i] ? getMod(character.stats[i]) : ''}</span>
                    <button class="roll-btn" id="roll-btn-${i}" onclick="rollStat(${i})" ${character.locked[i] ? 'disabled style="opacity:0.3;cursor:default"' : ''}>üé≤ ${character.locked[i] ? '‚úì' : 'Roll'}</button>
                </div>
            `).join('')}
        </div>
        <button class="roll-all-btn" id="roll-all-btn" onclick="rollAll()" ${character.locked.every(l => l) ? 'disabled style="opacity:0.3;cursor:default"' : ''}>üé≤ Roll All Stats</button>
        <button class="btn" id="next-btn" onclick="nextStep()" ${hasStats ? '' : 'disabled'}>Next</button>
    `;
}

function renderDice(rolls, total) {
    if (!rolls.length) return '';
    const sorted = [...rolls].sort((a, b) => a - b);
    return sorted.map((d, i) => i === 0 ? `<span style="text-decoration:line-through;opacity:0.4">${d}</span>` : d).join(' + ') + ` = ${total}`;
}

function rollStat(index) {
    if (character.locked[index]) return;

    const result = roll4d6();
    character.stats[index] = result.total;
    character.rolls[index] = result.dice;
    character.locked[index] = true;

    const valEl = document.getElementById(`stat-val-${index}`);
    const modEl = document.getElementById(`stat-mod-${index}`);
    const diceEl = document.getElementById(`dice-${index}`);
    const row = document.getElementById(`stat-row-${index}`);
    const rollBtn = document.getElementById(`roll-btn-${index}`);

    row.classList.add('rolling');
    setTimeout(() => row.classList.remove('rolling'), 400);

    valEl.textContent = result.total;
    modEl.textContent = getMod(result.total);
    diceEl.innerHTML = renderDice(result.dice, result.total);

    rollBtn.disabled = true;
    rollBtn.style.opacity = '0.3';
    rollBtn.style.cursor = 'default';
    rollBtn.textContent = 'üé≤ ‚úì';

    if (character.locked.every(l => l)) {
        const rollAllBtn = document.getElementById('roll-all-btn');
        if (rollAllBtn) {
            rollAllBtn.disabled = true;
            rollAllBtn.style.opacity = '0.3';
            rollAllBtn.style.cursor = 'default';
        }
    }

    if (character.stats.every(s => s > 0)) {
        document.getElementById('next-btn').disabled = false;
    }
}

function rollAll() {
    let delay = 0;
    statNames.forEach((_, i) => {
        if (!character.locked[i]) {
            setTimeout(() => rollStat(i), delay * 150);
            delay++;
        }
    });
}

function showBackgroundStep(card) {
    card.innerHTML = `
        <div class="step-title">Choose Your Background</div>
        <div class="step-subtitle">Where do you come from?</div>
        <div class="option-grid">
            ${backgrounds.map(b => `
                <div class="option-card ${character.background === b.name ? 'selected' : ''}" onclick="selectBackground('${b.name}')">
                    <span class="opt-icon">${b.icon}</span>
                    <div class="opt-name">${b.name}</div>
                    <div class="opt-desc">${b.desc}</div>
                </div>
            `).join('')}
        </div>
        <button class="btn" id="next-btn" onclick="nextStep()" ${character.background ? '' : 'disabled'}>Next</button>
    `;
}

function selectBackground(name) {
    character.background = name;
    document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
    event.target.closest('.option-card').classList.add('selected');
    document.getElementById('next-btn').disabled = false;
}

function showAlignmentStep(card) {
    card.innerHTML = `
        <div class="step-title">Choose Your Alignment</div>
        <div class="step-subtitle">Where does your moral compass point?</div>
        <div class="align-grid">
            ${alignments.map(a => `
                <div class="align-card ${character.alignment === a ? 'selected' : ''}" onclick="selectAlignment('${a}')">${a}</div>
            `).join('')}
        </div>
        <button class="btn" id="next-btn" onclick="finishCharacter()" ${character.alignment ? '' : 'disabled'}>Create Character!</button>
    `;
}

function selectAlignment(name) {
    character.alignment = name;
    document.querySelectorAll('.align-card').forEach(c => c.classList.remove('selected'));
    event.target.closest('.align-card').classList.add('selected');
    document.getElementById('next-btn').disabled = false;
}

function finishCharacter() {
    currentStep = 6;
    document.getElementById('progress-fill').style.width = '100%';
    document.getElementById('step-num').textContent = '‚úì';
    showStep();
}

// --- Derived stat helpers ---

function getFinalStats() {
    const rd = raceDetails[character.race];
    return character.stats.map((s, i) => s + (rd ? rd.bonuses[i] : 0));
}

function getModNum(stat) {
    return Math.floor((stat - 10) / 2);
}

function getSkillProficiencies() {
    const bg = bgDetails[character.background];
    const cls = classDetails[character.class];
    const proficient = new Set(bg ? bg.skills : []);
    // Racial skill proficiencies
    if (character.race === 'Elf') proficient.add('Perception');
    if (character.race === 'Half-Orc') proficient.add('Intimidation');
    // Auto-pick class skills that don't overlap with background/race
    let remaining = cls ? cls.numSkills : 0;
    for (const skill of (cls ? cls.skillChoices : [])) {
        if (remaining <= 0) break;
        if (!proficient.has(skill)) {
            proficient.add(skill);
            remaining--;
        }
    }
    return proficient;
}

function getSavingThrowProfs() {
    const cls = classDetails[character.class];
    return new Set(cls ? cls.saves : []);
}

function getAC() {
    const stats = getFinalStats();
    const dexMod = getModNum(stats[1]);
    const conMod = getModNum(stats[2]);
    const wisMod = getModNum(stats[4]);
    if (character.class === 'Barbarian') return 10 + dexMod + conMod;
    if (character.class === 'Monk') return 10 + dexMod + wisMod;
    if (['Wizard', 'Sorcerer'].includes(character.class)) return 10 + dexMod;
    if (['Bard', 'Rogue', 'Warlock'].includes(character.class)) return 11 + dexMod;
    if (['Ranger', 'Druid'].includes(character.class)) return 14 + Math.min(dexMod, 2);
    if (['Fighter', 'Paladin', 'Cleric'].includes(character.class)) return 16;
    return 10 + dexMod;
}

function getACSource() {
    if (character.class === 'Barbarian') return 'Unarmored';
    if (character.class === 'Monk') return 'Unarmored';
    if (['Wizard', 'Sorcerer'].includes(character.class)) return 'No armor';
    if (['Bard', 'Rogue', 'Warlock'].includes(character.class)) return 'Leather';
    if (['Ranger', 'Druid'].includes(character.class)) return 'Scale mail';
    if (['Fighter', 'Paladin', 'Cleric'].includes(character.class)) return 'Chain mail';
    return '';
}

function getHP() {
    const stats = getFinalStats();
    const conMod = getModNum(stats[2]);
    const cd = classDetails[character.class];
    return (cd ? cd.hitDie : 8) + conMod;
}

function getPassivePerception() {
    const stats = getFinalStats();
    const wisMod = getModNum(stats[4]);
    const skillProfs = getSkillProficiencies();
    return 10 + wisMod + (skillProfs.has('Perception') ? 2 : 0);
}

// --- Character Sheet ---

function showSheet(card) {
    const raceObj = races.find(r => r.name === character.race);
    const classObj = classes.find(c => c.name === character.class);
    const bgObj = backgrounds.find(b => b.name === character.background);
    const rd = raceDetails[character.race];
    const cd = classDetails[character.class];
    const bd = bgDetails[character.background];
    const finalStats = getFinalStats();
    const profBonus = 2; // Level 1
    const skillProfs = getSkillProficiencies();
    const saveProfs = getSavingThrowProfs();
    const ac = getAC();
    const hp = getHP();
    const initiative = getModNum(finalStats[1]);

    // Ability scores
    const statsHtml = statNames.map((s, i) => {
        const bonus = rd.bonuses[i];
        const final = finalStats[i];
        const mod = getModNum(final);
        return `<div class="stat-box">
            <div class="sb-label">${s.abbr}</div>
            <div class="sb-mod">${getMod(final)}</div>
            <div class="sb-score">${final}</div>
            ${bonus > 0 ? `<div class="sb-bonus">+${bonus} ${character.race}</div>` : ''}
        </div>`;
    }).join('');

    // Saving throws
    const savesHtmlFixed = statNames.map((s, i) => {
        const prof = saveProfs.has(i);
        const mod = getModNum(finalStats[i]) + (prof ? profBonus : 0);
        const modStr = mod >= 0 ? `+${mod}` : `${mod}`;
        return `<div class="save-skill-row">
            <span class="prof-dot ${prof ? 'filled' : ''}"></span>
            <span class="sk-mod">${modStr}</span>
            <span class="sk-name">${s.name}</span>
        </div>`;
    }).join('');

    // Skills
    const skillsHtml = allSkills.map(skill => {
        const prof = skillProfs.has(skill.name);
        const mod = getModNum(finalStats[skill.ability]) + (prof ? profBonus : 0);
        const modStr = mod >= 0 ? `+${mod}` : `${mod}`;
        return `<div class="save-skill-row">
            <span class="prof-dot ${prof ? 'filled' : ''}"></span>
            <span class="sk-mod">${modStr}</span>
            <span class="sk-name">${skill.name}</span>
            <span class="sk-ability">${statNames[skill.ability].abbr}</span>
        </div>`;
    }).join('');

    // Languages
    const languages = [...rd.languages];
    if (bd.languages > 0) {
        for (let i = 0; i < bd.languages; i++) languages.push('One extra');
    }

    // Tools
    const tools = bd.tools.length > 0 ? bd.tools.join(', ') : 'None';

    // Features & Traits
    const features = [
        ...rd.traits.map(t => ({ source: character.race, name: t })),
        ...cd.features.map(f => ({ source: character.class, name: f })),
        { source: character.background, name: bd.feature }
    ];

    // Equipment
    const equipment = [...cd.equipment, ...bd.equipment];

    const initStr = initiative >= 0 ? `+${initiative}` : `${initiative}`;

    card.innerHTML = `
        <div class="sheet">
            <div class="sheet-name">${character.name}</div>
            <div class="sheet-subtitle">${raceObj.icon} ${character.race} ${classObj.icon} ${character.class} &middot; Level 1</div>

            <div class="sheet-header-bar">
                <div class="sheet-header-item">
                    <div class="label">Background</div>
                    <div class="value">${bgObj.icon} ${character.background}</div>
                </div>
                <div class="sheet-header-item">
                    <div class="label">Alignment</div>
                    <div class="value">${character.alignment}</div>
                </div>
            </div>

            <div class="combat-row">
                <div class="combat-box">
                    <div class="label">Armor Class</div>
                    <div class="value">${ac}</div>
                    <div class="sub">${getACSource()}</div>
                </div>
                <div class="combat-box">
                    <div class="label">Initiative</div>
                    <div class="value">${initStr}</div>
                    <div class="sub">DEX mod</div>
                </div>
                <div class="combat-box">
                    <div class="label">Speed</div>
                    <div class="value">${rd.speed}</div>
                    <div class="sub">feet</div>
                </div>
                <div class="combat-box hp-box">
                    <div class="label">Hit Points</div>
                    <div class="value">${hp}</div>
                    <div class="sub">1d${cd.hitDie} + CON</div>
                </div>
            </div>

            <div class="prof-bonus-bar">
                Proficiency Bonus: <strong>+${profBonus}</strong> &nbsp;&middot;&nbsp; Hit Dice: <strong>1d${cd.hitDie}</strong> &nbsp;&middot;&nbsp; Passive Perception: <strong>${getPassivePerception()}</strong>
            </div>

            <div class="sheet-section">
                <div class="sheet-section-title">Ability Scores</div>
                <div class="sheet-stats-grid-6">${statsHtml}</div>
            </div>

            <div class="sheet-section">
                <div class="sheet-section-title">Saving Throws</div>
                <div class="saves-skills-grid">${savesHtmlFixed}</div>
            </div>

            <div class="sheet-section">
                <div class="sheet-section-title">Skills</div>
                <div class="saves-skills-grid">${skillsHtml}</div>
            </div>

            <div class="sheet-section">
                <div class="sheet-section-title">Proficiencies & Languages</div>
                <div class="prof-category"><span class="pc-label">Armor: </span><span class="pc-value">${cd.armor}</span></div>
                <div class="prof-category"><span class="pc-label">Weapons: </span><span class="pc-value">${cd.weapons}</span></div>
                <div class="prof-category"><span class="pc-label">Tools: </span><span class="pc-value">${tools}</span></div>
                <div class="prof-category"><span class="pc-label">Languages: </span><span class="pc-value">${languages.join(', ')}</span></div>
            </div>

            <div class="sheet-section">
                <div class="sheet-section-title">Features & Traits</div>
                ${features.map(f => `<div class="trait-item"><span class="trait-name">${f.name}</span> <span class="sk-ability">(${f.source})</span></div>`).join('')}
            </div>

            <div class="sheet-section">
                <div class="sheet-section-title">Equipment</div>
                ${equipment.map(e => `<div class="equip-item">&bull; ${e}</div>`).join('')}
            </div>

            <div class="btn-row-3">
                <button class="btn btn-secondary" onclick="copyCharacter()">üìã Copy</button>
                <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print</button>
                <button class="btn" onclick="startOver()">üêâ New</button>
            </div>
        </div>
    `;
}

function copyCharacter() {
    const finalStats = getFinalStats();
    const rd = raceDetails[character.race];
    const cd = classDetails[character.class];
    const stats = statNames.map((s, i) => `${s.abbr}: ${finalStats[i]} (${getMod(finalStats[i])})`).join(', ');
    const initMod = getModNum(finalStats[1]);
    const initStr = initMod >= 0 ? `+${initMod}` : `${initMod}`;
    const text = `${character.name} ‚Äî ${character.race} ${character.class} (Level 1)
Alignment: ${character.alignment} | Background: ${character.background}
HP: ${getHP()} | AC: ${getAC()} | Initiative: ${initStr} | Speed: ${rd.speed} ft
${stats}
Made with Penny's D&D Character Creator: ${window.location.href}`;

    navigator.clipboard.writeText(text).then(() => {
        const btn = document.querySelector('.btn-row-3 .btn-secondary');
        const orig = btn.textContent;
        btn.textContent = '‚úì Copied!';
        setTimeout(() => btn.textContent = orig, 2000);
    });
}

function startOver() {
    character = { name: "", race: null, class: null, stats: [0,0,0,0,0,0], rolls: [[],[],[],[],[],[]], locked: [false,false,false,false,false,false], background: null, alignment: null };
    currentStep = 0;
    showStep();
}

function nextStep() {
    currentStep++;
    showStep();
}

// Start
showStep();
    </script>
</body>
</html>
